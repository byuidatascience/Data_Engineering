{"paragraphs":[{"text":"%pyspark\ntweets = sc.textFile(\"s3a://conor-twitter-firehose/2017/04/*/*/*\")\n\ndef get_langs(tweet_str):\n    '''\n    INPUT: string of tweet\n    OUTPUT: list of length 2 w/ the following values:\n            text\n            lang\n    '''\n    import json\n    try:\n        tweet = json.loads(tweet_str)\n        text = tweet.get('text')\n        lang = tweet.get('lang')\n            \n        if lang == 'en':\n            return [text, 0]\n        elif lang == 'es':\n            return [text, 1]\n        else:\n            pass\n    except ValueError:\n        pass\n\ndf = tweets.map(get_langs).filter(lambda x: x is not None).toDF(['tweet', 'lang']).cache()\n\n","user":"anonymous","dateUpdated":"2017-04-24T15:43:15+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1492891536416_547867349","id":"20170422-200536_1803124296","dateCreated":"2017-04-22T20:05:36+0000","dateStarted":"2017-04-24T15:43:15+0000","dateFinished":"2017-04-24T15:43:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3164"},{"text":"%pyspark\nfrom pyspark.ml.feature import RegexTokenizer, HashingTF, IDF\nfrom pyspark.ml import Pipeline\nfrom pyspark.ml.classification import RandomForestClassifier\n\ntokenizer = RegexTokenizer(inputCol=\"tweet\", outputCol=\"words\", pattern='\\s+|[,.\\\"]')\nhashingTF = HashingTF(inputCol=\"words\", outputCol=\"rawFeatures\", numFeatures=200)\nidf = IDF(inputCol=\"rawFeatures\", outputCol=\"features\")\nforestizer = RandomForestClassifier(labelCol=\"lang\", featuresCol=\"features\", numTrees=10)\n\npipeline = Pipeline(stages=[\\\n                tokenizer, \n                hashingTF, \n                idf,\n                forestizer])\n","user":"anonymous","dateUpdated":"2017-04-24T19:10:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1492891587437_-129614167","id":"20170422-200627_2104589309","dateCreated":"2017-04-22T20:06:27+0000","dateStarted":"2017-04-24T15:43:18+0000","dateFinished":"2017-04-24T15:43:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3165"},{"text":"%pyspark\n\ntweets_train, tweets_test = df.randomSplit([0.7, 0.3], seed=123)\n\nmodel = pipeline.fit(tweets_train)\ntest_model = model.transform(tweets_test)","user":"anonymous","dateUpdated":"2017-04-24T15:43:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1492891627556_307722739","id":"20170422-200707_580630667","dateCreated":"2017-04-22T20:07:07+0000","dateStarted":"2017-04-24T15:43:48+0000","dateFinished":"2017-04-24T16:45:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3166"},{"text":"%pyspark\nimport pyspark.ml.evaluation as ev\n\nevaluator = ev.BinaryClassificationEvaluator(rawPredictionCol='probability', labelCol='lang')\nprint('AUC for Random Forest:', evaluator.evaluate(test_model, {evaluator.metricName: 'areaUnderROC'}))\nprint('APR for Random Forest:', evaluator.evaluate(test_model, {evaluator.metricName: 'areaUnderPR'}))","user":"anonymous","dateUpdated":"2017-04-24T15:43:24+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"('AUC for Random Forest:', 0.9074535775862083)\n('APR for Random Forest:', 0.8123094078113648)\n"}]},"apps":[],"jobName":"paragraph_1492891639895_1012228624","id":"20170422-200719_1495094582","dateCreated":"2017-04-22T20:07:19+0000","dateStarted":"2017-04-24T15:43:48+0000","dateFinished":"2017-04-24T17:51:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3167"},{"text":"%pyspark\npipeline.save('s3a://conor-sandbox/6-4-ML-pipeline')\nmodel.save('s3a://conor-sandbox/6-4-ML-model')","user":"anonymous","dateUpdated":"2017-04-24T19:10:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493057992299_-2130829152","id":"20170424-181952_1688208586","dateCreated":"2017-04-24T18:19:52+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3168"},{"text":"%pyspark\ntokenized = tokenizer.transform(df) # Take a look at the tokenized text\ntokenized.take(10)","user":"anonymous","dateUpdated":"2017-04-24T19:10:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(tweet=u'Victor Hugo y C5N defendiendo al dictador Maduro cuando hay 2 muertos en Venezuela. Vayanse al carajo basuras, lacras.', lang=1, words=[u'victor', u'hugo', u'y', u'c5n', u'defendiendo', u'al', u'dictador', u'maduro', u'cuando', u'hay', u'2', u'muertos', u'en', u'venezuela', u'vayanse', u'al', u'carajo', u'basuras', u'lacras']), Row(tweet=u'Al C\\xe9sar lo que es del C\\xe9sar yyyyyyy\\n\\xbfAl Guaire?\\nAunque usted no lo crea, SE BA\\xd1ARON en el Guaire https://t.co/8IrM320fUk', lang=1, words=[u'al', u'c\\xe9sar', u'lo', u'que', u'es', u'del', u'c\\xe9sar', u'yyyyyyy', u'\\xbfal', u'guaire?', u'aunque', u'usted', u'no', u'lo', u'crea', u'se', u'ba\\xf1aron', u'en', u'el', u'guaire', u'https://t', u'co/8irm320fuk']), Row(tweet=u'A new model for lectures in the post-truth era? https://t.co/8AImi8D4pT', lang=0, words=[u'a', u'new', u'model', u'for', u'lectures', u'in', u'the', u'post-truth', u'era?', u'https://t', u'co/8aimi8d4pt']), Row(tweet=u'Those \"get ___ rt\\'s and I\\'ll get you ____\" tweets...\\n\\nThey\\'re both annoying and sweet all at once.\\n\\nLow key wish that could happen to me', lang=0, words=[u'those', u'get', u'___', u\"rt's\", u'and', u\"i'll\", u'get', u'you', u'____', u'tweets', u\"they're\", u'both', u'annoying', u'and', u'sweet', u'all', u'at', u'once', u'low', u'key', u'wish', u'that', u'could', u'happen', u'to', u'me']), Row(tweet=u'What do you think of the summer fashion trend. https://t.co/COPufAE6LV', lang=0, words=[u'what', u'do', u'you', u'think', u'of', u'the', u'summer', u'fashion', u'trend', u'https://t', u'co/copufae6lv']), Row(tweet=u'La Dana me pide las fotos de ese chico JAJJAJA La amo\\U0001f498', lang=1, words=[u'la', u'dana', u'me', u'pide', u'las', u'fotos', u'de', u'ese', u'chico', u'jajjaja', u'la', u'amo\\U0001f498']), Row(tweet=u'Something about the word \"babygirl\" \\U0001f60d\\U0001f60d\\U0001f629\\U0001f629', lang=0, words=[u'something', u'about', u'the', u'word', u'babygirl', u'\\U0001f60d\\U0001f60d\\U0001f629\\U0001f629']), Row(tweet=u'@joeliis_perez @ceila_garcia @Wwiile Esas mamis \\U0001f60d\\u2764\\ufe0f\\ufe0f', lang=1, words=[u'@joeliis_perez', u'@ceila_garcia', u'@wwiile', u'esas', u'mamis', u'\\U0001f60d\\u2764\\ufe0f\\ufe0f']), Row(tweet=u'all relationships go through bad times, but real relationships get through bad times', lang=0, words=[u'all', u'relationships', u'go', u'through', u'bad', u'times', u'but', u'real', u'relationships', u'get', u'through', u'bad', u'times']), Row(tweet=u'Blue skies forever', lang=0, words=[u'blue', u'skies', u'forever'])]\n"}]},"apps":[],"jobName":"paragraph_1492892710434_-291956301","id":"20170422-202510_675556168","dateCreated":"2017-04-22T20:25:10+0000","dateStarted":"2017-04-22T23:20:37+0000","dateFinished":"2017-04-22T23:20:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3169"},{"text":"%pyspark\ndf.count() # Total tweets used (both training and test sets)","user":"anonymous","dateUpdated":"2017-04-24T19:10:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"13207941\n"}]},"apps":[],"jobName":"paragraph_1492897201433_-948132729","id":"20170422-214001_1109707538","dateCreated":"2017-04-22T21:40:01+0000","dateStarted":"2017-04-24T18:06:06+0000","dateFinished":"2017-04-24T18:06:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3170"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-04-24T18:15:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493057753131_-838390843","id":"20170424-181553_1217818640","dateCreated":"2017-04-24T18:15:53+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3171"}],"name":"lab_soln-6-4","id":"2CE9Q9N9V","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}